openapi: 3.0.3
info:
  title: pagoPa RTP - OpenAPI 3.x
  description: DESCRIPTION
  version: 0.0.1
  contact:
    email: cstar@pagopa.it
servers:
  - url: http://localhost:8080
tags:
  - name: rtps
    description: API Group aims to notify a pagoPa notice through Request To Pay (RTP)
  - name: gpd-messages
    description: >
      Endpoints for ingesting GPD messages and converting them into Request To Pay (RTP)
      lifecycle operations.
paths:
  /rtps/delivery-status:
    get:
      operationId: getDeliveryStatus
      summary: Check PD delivery status to RTP
      description: Returns the delivery outcome for a debt position (PD) identified by notice number (NAV) and payeeId, based on DB records. The endpoint always responds with 200 and reports the outcome in the payload. If a record with status SENT is found, the PD is considered “PD_RTP_DELIVERED”. If the status is ERROR_SEND or ERROR_SENT, the PD is considered “PD_NOT_DELIVERED”. When available, the response also includes the RTP processing or sending date.
      tags: [ rtps ]
      security:
        - oAuth2: [ admin_rtp_send, payee_read_rtp ]
      parameters:
        - $ref: '#/components/parameters/NoticeNumber'
        - $ref: '#/components/parameters/RequestId'
        - $ref: '#/components/parameters/Version'
        - $ref: '#/components/parameters/payeeId'

      responses:
        "200":
          $ref: '#/components/responses/RtpDeliveryStatus'
        "401":
          #description: Wrong credentials.
          $ref: '#/components/responses/Error'
        "403":
          #description: Forbidden.
          $ref: '#/components/responses/Error'
        "429":
          #description: Too many requests
          $ref: '#/components/responses/Error'
        "500":
          #description: Server error.
          $ref: '#/components/responses/Error'
        "504":
          #description: Timeout communicating with Debtor Service Provider.
          $ref: '#/components/responses/Error'

  /rtps:
    get:
      operationId: findRtpByNoticeNumber
      summary: Retrieve RTPs by their Notice Number associated
      description: Returns RTP data associated with the given ID
      tags: [ rtps ]
      security:
        - oAuth2: [ admin_rtp_send, read_rtp_send ]
      parameters:
        - $ref: '#/components/parameters/NoticeNumber'
        - $ref: '#/components/parameters/RequestId'
        - $ref: '#/components/parameters/Version'
      responses:
        "200":
          $ref: '#/components/responses/RtpListByNoticeNumber'
        "400":
          #description: Bad request.
          $ref: '#/components/responses/Error'
        "401":
          #description: Wrong credentials.
          $ref: '#/components/responses/Error'
        "403":
          #description: Forbidden.
          $ref: '#/components/responses/Error'
        "404":
          #description: Not found.
          $ref: '#/components/responses/Error'
        "406":
          #description: Not acceptable. Did you require application/json?
          $ref: '#/components/responses/Error'
        "429":
          #description: Too many requests
          $ref: '#/components/responses/Error'
        "500":
          #description: Server error.
          $ref: '#/components/responses/Error'
        "504":
          #description: Timeout communicating with Debtor Service Provider.
          $ref: '#/components/responses/Error'
        default:
          #description: Unexpected error.
          $ref: '#/components/responses/Error'
    post:
      tags:
        - rtps
      operationId: "createRtp"
      parameters:
        - $ref: '#/components/parameters/Version'
      security:
        - oAuth2: [ admin_rtp_send, write_rtp_send ]
      summary: "Create and send a new RTP from a pagoPa notice"
      description: "Create and send a new RTP from a pagoPa notice"
      requestBody:
        description: "pagoPa notice's details to create as RTP"
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateRtp"
      responses:
        "201":
          description: "Request to pay created and sent"
          headers:
            Location:
              required: true
              description: "The location of created rtp"
              schema:
                $ref: "#/components/schemas/RtpLocation"
        "400":
          description: "The request is malformed"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MalformedRequestErrorResponse'
        "422":
          description: "The debtor is not activated by the Service Provider"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MismatchActivationErrorResponse'

  /rtps/{rtpId}/cancel:
    post:
      operationId: cancelRtp
      summary: Cancels a RTP.
      description: The operation cancels a RTP searching it by its ID.
      tags: [ rtps ]
      security:
        - oAuth2: [ admin_rtp_send, write_rtp_send ]
      parameters:
        - $ref: '#/components/parameters/RequestId'
        - $ref: '#/components/parameters/Version'
        - $ref: '#/components/parameters/RtpId'
      responses:
        "204":
          #description: No content
          $ref: '#/components/responses/NoContent'
        "400":
          #description: Bad request
          $ref: '#/components/responses/Error'
        "401":
          #description: Wrong credentials
          $ref: '#/components/responses/Error'
        "403":
          #description: Forbidden
          $ref: '#/components/responses/Error'
        "404":
          #description: Not found
          $ref: '#/components/responses/Error'
        "406":
          #description: Not acceptable. Did you require application/json?
          $ref: '#/components/responses/Error'
        "422":
          #description: Unprocessable entity
          $ref: '#/components/responses/Error'
        "429":
          #description: Too many request
          $ref: '#/components/responses/Error'
        "500":
          #description: Server error
          $ref: '#/components/responses/Error'
        "504":
          #description: Timeout communicating with Debtor Service Provider
          $ref: '#/components/responses/Error'
        default:
          #description: Unexpected error
          $ref: '#/components/responses/Error'

  /rtps/{rtpId}:
    get:
      operationId: findRtpById
      summary: Retrieve a RTP by its ID
      description: Returns RTP data associated with the given ID
      tags: [ rtps ]
      security:
        - oAuth2: [ admin_rtp_send, read_rtp_send ]
      parameters:
        - $ref: '#/components/parameters/RequestId'
        - $ref: '#/components/parameters/Version'
        - $ref: '#/components/parameters/RtpId'
      responses:
        "200":
          $ref: '#/components/responses/findRtp'
        "400":
          #description: Bad request.
          $ref: '#/components/responses/Error'
        "401":
          #description: Wrong credentials.
          $ref: '#/components/responses/Error'
        "403":
          #description: Forbidden.
          $ref: '#/components/responses/Error'
        "404":
          #description: Not found.
          $ref: '#/components/responses/Error'
        "406":
          #description: Not acceptable. Did you require application/json?
          $ref: '#/components/responses/Error'
        "429":
          #description: Too many requests
          $ref: '#/components/responses/Error'
        "500":
          #description: Server error.
          $ref: '#/components/responses/Error'
        "504":
          #description: Timeout communicating with Debtor Service Provider.
          $ref: '#/components/responses/Error'
        default:
          #description: Unexpected error.
          $ref: '#/components/responses/Error'

  /gpd/message:
    post:
      tags:
        - gpd-messages
      operationId: processGpdMessage
      summary: Process a GPD message into an RTP operation
      description: >
        Accepts a GPD message and translates it into a corresponding Request To Pay (RTP)
        operation. Depending on the message content and operation type, this may result
        in the creation, update, or cancellation of an RTP.
      parameters:
        - $ref: '#/components/parameters/Version'
        - $ref: '#/components/parameters/RequestId'
        - $ref: '#/components/parameters/Idempotency-Key'
      security:
        - oauth2: [ admin_rtp_send, process_rtp_send ]
      requestBody:
        description: >
          GPD message payload containing the operation type, identifiers, and payment
          information required to process a Request To Pay (RTP).
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/GpdMessage"
      responses:
        "200":
          $ref: '#/components/responses/RtpResponse'
        "400":
          #description: Bad request.
          $ref: '#/components/responses/ErrorResponse'
        "401":
          #description: Wrong credentials.
          $ref: '#/components/responses/UnauthorizedError'
        "403":
          #description: Forbidden
          $ref: '#/components/responses/ForbiddenError'
        "406":
          #description: Not acceptable. Did you require application/json?
          $ref: '#/components/responses/GenericError'
        "409":
          #description: Conflict.
          $ref: '#/components/responses/ConflictError'
        "415":
          #description: Unsupported media type. Did you provide application/json?
          $ref: '#/components/responses/GenericError'
        "429":
          #description: Too many request.
          $ref: '#/components/responses/GenericError'
        "500":
          #description: Server error.
          $ref: '#/components/responses/GenericError'
        default:
          #description: Unexpected error.
          $ref: '#/components/responses/GenericError'

components:
  schemas:
    AccessControlAllowOrigin:
      description: |
        Indicates whether the response can be shared with requesting code from
        the given origin.
      type: string
      pattern: "^[ -~]{1,2048}$"
      minLength: 1
      maxLength: 2048

    WWWAuthenticate:
      description: |
        Indicates the authentication scheme(s) and parameters required to access a protected resource.
      type: string
      pattern: "^[ -~]{1,2048}$"
      minLength: 1
      maxLength: 2048

    RateLimitLimit:
      description: The number of allowed requests in the current period.
      type: integer
      format: int32
      minimum: 1
      maximum: 240

    RateLimitReset:
      description: The number of seconds left in the current period.
      type: integer
      format: int32
      minimum: 1
      maximum: 60

    RetryAfter:
      description: |
        The number of seconds to wait before allowing a follow-up request.
      type: integer
      format: int32
      minimum: 1
      maximum: 240

    ErrorCode:
      description: Error code.
      type: string
      pattern: "^[A-F0-9]{9}$"
      minLength: 9
      maxLength: 9
      example: "01000000F"

    ErrorDescription:
      description: Error description.
      type: string
      pattern: "^[ -~]{0,256}$"
      minLength: 0
      maxLength: 256
      example: "Wrong party identifier"

    StatusCode:
      description: HTTP status code.
      type: integer
      format: int32
      minimum: 0
      maximum: 999
      example: 401

    Error:
      description: Error details.
      type: object
      additionalProperties: false
      properties:
        code:
          $ref: '#/components/schemas/ErrorCode'
        description:
          $ref: '#/components/schemas/ErrorDescription'
      required:
        - code
        - description
      example:
        code: "01000000F"
        description: "Wrong party identifier"

    Errors:
      description: |
        Error details.
        The format depends on the component which returns it.
      oneOf:
        - $ref: '#/components/schemas/Type1Error'
        - $ref: '#/components/schemas/Type2Error'
        - $ref: '#/components/schemas/Type3Error'

    Type1Error:
      description: List of errors returned by the application.
      type: object
      additionalProperties: false
      properties:
        errors:
          type: array
          minItems: 1
          maxItems: 32
          items:
            $ref: '#/components/schemas/Error'
      required:
        - errors
      example:
        errors:
          - code: "01000000F"
            description: "Wrong party identifier"

    Type2Error:
      description: Error details returned by the APIM.
      type: object
      additionalProperties: false
      properties:
        statusCode:
          $ref: '#/components/schemas/StatusCode'
        message:
          $ref: '#/components/schemas/ErrorDescription'
      required:
        - statusCode
        - message
      example:
        statusCode: 401
        message: "Invalid JWT."

    Type3Error:
      description: Error details returned by the framework.
      type: object
      additionalProperties: false
      properties:
        timestamp:
          description: Timestamp the error occurred.
          type: string
          format: date-time
          minLength: 19
          maxLength: 29
          pattern: "^((?:(\\d{4}-\\d{2}-\\d{2})T(\\d{2}:\\d{2}:\\d{2}(?:\\.\\d+)?))(Z|[\\+-]\\d{2}:\\d{2})?)$"
        path:
          description: API path where the error occurred.
          type: string
          pattern: "^[ -~]{1,1024}$"
          minLength: 1
          maxLength: 1024
        status:
          $ref: '#/components/schemas/StatusCode'
        error:
          $ref: '#/components/schemas/ErrorDescription'
        requestId:
          description: ID of the request.
          type: string
          pattern: "^[ -~]{1,128}$"
          minLength: 1
          maxLength: 128
      required:
        - timestamp
        - path
        - status
        - error
        - requestId
      example:
        timestamp: "2024-12-31T09:54:01.763+00:00"
        path: "/activations"
        status: 415
        error: "Unsupported Media Type"
        requestId: "3fb00d0f-416"

    AmountEuroCents:
      description: Amount for payments, in euro cents
      type: number
      minimum: 0
      maximum: 99999999999

    GpdAmountEuroCents:
      description: Amount for payments, in euro cents
      type: integer
      format: int64
      minimum: 0
      maximum: 99999999999
      example: 105000

    NoticeNumber:
      type: string
      minLength: 15
      maxLength: 21
      pattern: "^\\d{15,21}$"
      description: "pagoPa notice's code"
      example: "311111111112222222"
      externalDocs:
        description: "See noticeNumber field"
        url: "https://docs.pagopa.it/sanp/appendici/primitive#verifypaymentnotice-1"

    Payee:
      type: object
      properties:
        payeeId:
          $ref: "#/components/schemas/PayeeId"
        name:
          type: string
          maxLength: 140
          description: "The name of payee (e.g. EC name or Company Name)"
          example: "Comune di Roma"
        payTrxRef:
          $ref: "#/components/schemas/PayTrxRef"
      required:
        - payeeId
        - name
        - payTrxRef

    Payer:
      type: object
      properties:
        payerId:
          $ref: "#/components/schemas/PayerId"
        name:
          type: string
          maxLength: 140
          description: "The name of payer."
          example: "Mario Rossi"
      required:
        - payerId
        - name

    PaymentNotice:
      type: object
      properties:
        noticeNumber:
          $ref: "#/components/schemas/NoticeNumber"
        amount:
          $ref: "#/components/schemas/AmountEuroCents"
        description:
          type: string
          description: "The pagopa notice's description"
          maxLength: 140
        subject:
          type: string
          description: "The subject of payment ( e.g. TARI 2025 )"
          maxLength: 140
        expiryDate:
          type: string
          description: "The pagoPa notice's expiry date. Formatted as ISO 8601 [YYYY]-[MM]-[DD]"
          format: date
          example: "2024-12-03"
      required:
        - noticeNumber
        - amount
        - description
        - subject
        - expiryDate

    PayerId:
      type: string
      description: "The id of the recipient of the request to pay. The id is the fiscal code"
      pattern: "^(([A-Z]{6}\\d{2}[A-Z]\\d{2}[A-Z]\\d{3}[A-Z])|(\\d{11}))$"
      example: "ABCDEF12G34H567I"

    PayeeId:
      type: string
      pattern: "\\d{11}|\\d{16}"
      description: "The payee id (e.g. EC fiscal code)"
      example: "77777777777"
      externalDocs:
        description: "See idPA field"
        url: "https://docs.pagopa.it/sanp/appendici/primitive#paverifypaymentnotice"

    PayTrxRef:
      type: string
      pattern: "^[ -~]{1,140}$"
      description: "The Pay Transaction Reference"
      example: "ABC/124"

    RtpId:
      type: string
      format: uuid
      description: "Request to pay unique id"

    RtpLocation:
      type: string
      description: "The location of created resource"
      format: url
      example: "https://domain.com/rtps/{rtpId}"

    CreateRtp:
      type: object
      properties:
        payee:
          $ref: "#/components/schemas/Payee"
        payer:
          $ref: "#/components/schemas/Payer"
        paymentNotice:
          $ref: "#/components/schemas/PaymentNotice"
      required:
        - paymentNotice
        - payer
        - payee

    RtpList:
      type: array
      items:
        $ref: "#/components/schemas/Rtp"

    RtpDeliveryResponse:
      type: object
      required:
        - status
      properties:
        status:
          type: string
          enum:
            - PD_RTP_DELIVERED
            - PD_RTP_NOT_DELIVERED
          example: PD_RTP_DELIVERED
        processingDate:
          type: string
          format: date-time
          minLength: 10
          maxLength: 30
          pattern: '^((?:(\d{4}-\d{2}-\d{2})T(\d{2}:\d{2}:\d{2}(?:\.\d+)?))(Z|[\+-]\d{2}:\d{2})?)$'
          example: "2025-06-06T08:40:16.781Z"

    Rtp:
      type: object
      properties:
        resourceID:
          type: string
          format: uuid
          minLength: 36
          maxLength: 36
          pattern: "^[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}$"
          example: "3fa85f64-5717-4562-b3fc-2c963f66afa6"
        noticeNumber:
          type: string
          minLength: 15
          maxLength: 21
          pattern: "^\\d{15,21}$"
          example: "311111111112222123"
        amount:
          type: number
          format: double
          example: 1050.75
        description:
          type: string
          minLength: 1
          maxLength: 255
          pattern: "^[ -~]{1,255}$"
          example: "Paga questo avviso"
        expiryDate:
          type: string
          format: date
          minLength: 10
          maxLength: 30
          pattern: "^\\d{4}-\\d{2}-\\d{2}$"
          example: "2025-12-31"
        payerName:
          type: string
          minLength: 1
          maxLength: 255
          pattern: "^[ -~]{1,255}$"
          example: "Pigrolo"
        payerId:
          type: string
          minLength: 11
          maxLength: 16
          pattern: "^(([A-Z]{6}\\d{2}[A-Z]\\d{2}[A-Z]\\d{3}[A-Z])|(\\d{11}))$"
          example: "RSSMRA85T10A562S"
        payeeName:
          type: string
          minLength: 1
          maxLength: 255
          pattern: "^[ -~]{1,255}$"
          example: "Comune di Roma"
        payeeId:
          type: string
          minLength: 11
          maxLength: 16
          pattern: "\\d{11}|\\d{16}"
          example: "77777777777"
        subject:
          type: string
          minLength: 1
          maxLength: 255
          pattern: "^[ -~]{1,255}$"
          example: "TARI 2025"
        savingDateTime:
          type: string
          format: date-time
          minLength: 10
          maxLength: 30
          pattern: "^((?:(\\d{4}-\\d{2}-\\d{2})T(\\d{2}:\\d{2}:\\d{2}(?:\\.\\d+)?))(Z|[\\+-]\\d{2}:\\d{2})?)$"
          example: "2025-06-06T08:40:16.781Z"
        serviceProviderDebtor:
          type: string
          minLength: 1
          maxLength: 100
          pattern: "^[ -~]{1,100}$"
          example: "FAKESP01"
        iban:
          type: string
          minLength: 15
          maxLength: 34
          pattern: "^[A-Z]{2}\\d{2}[A-Z0-9]{1,30}$"
          example: "IT60X0542811101000000123456"
        payTrxRef:
          type: string
          minLength: 1
          maxLength: 64
          pattern: "^[ -~]{1,64}$"
          example: "ABC/124"
        flgConf:
          type: string
          minLength: 1
          maxLength: 10
          pattern: "^[a-zA-Z_]{1,10}$"
          example: "flgConf"
        status:
          $ref: '#/components/schemas/RtpStatus'
        serviceProviderCreditor:
          type: string
          minLength: 1
          maxLength: 100
          pattern: "^[ -~]{1,100}$"
          example: "PA123456789"
        events:
          type: array
          maxItems: 100
          items:
            $ref: '#/components/schemas/Event'
          example:
            - timestamp: "2025-06-06T08:40:16.781Z"
              precStatus: "CREATED"
              triggerEvent: "CREATE_RTP"

    Event:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
          maxLength: 30
          pattern: "^((?:(\\d{4}-\\d{2}-\\d{2})T(\\d{2}:\\d{2}:\\d{2}(?:\\.\\d+)?))(Z|[\\+-]\\d{2}:\\d{2})?)$"
        precStatus:
          $ref: '#/components/schemas/RtpStatus'
        triggerEvent:
          $ref: '#/components/schemas/RtpEvent'
      required:
        - timestamp
        - triggerEvent

    RtpStatus:
      type: string
      enum:
        - CREATED
        - SENT
        - CANCELLED
        - ACCEPTED
        - REJECTED
        - USER_ACCEPTED
        - USER_REJECTED
        - PAID
        - ERROR_SEND
        - CANCELLED_PAID
        - CANCELLED_ACCR
        - CANCELLED_REJECTED
        - ERROR_CANCEL
        - RFC_SENT

    RtpEvent:
      type: string
      enum:
        - CREATE_RTP
        - SEND_RTP
        - CANCEL_RTP
        - ACCEPT_RTP
        - REJECT_RTP
        - USER_ACCEPT_RTP
        - USER_REJECT_RTP
        - PAY_RTP
        - ERROR_SEND_RTP
        - ERROR_CANCEL_RTP
        - CANCEL_RTP_ACCR
        - CANCEL_RTP_REJECTED
        - CONFIRM_RFC
        - CANCEL_RTP_PAID

    GenericError:
      description: Generic error.
      type: object
      additionalProperties: false
      properties:
        timestamp:
          type: string
          format: date-time
          description: The time the error occurred.
        path:
          type: string
          description: The API path where the error occurred.
        status:
          type: integer
          description: HTTP status code of the error.
        statusCode:
          type: integer
          description: HTTP status code of the error.
        error:
          type: string
          description: Description of the error.
        message:
          type: string
          description: Description of the error.
        requestId:
          type: string
          description: Unique identifier for the request.
      example:
        timestamp: "2024-12-31T09:54:01.763+00:00"
        path: "/activations"
        status: 415
        error: "Unsupported Media Type"
        requestId: "74039ba5-7040-42b4-ab86-b9ad88e4114c"

    ErrorSchema:
      description: Error details.
      type: object
      additionalProperties: false
      properties:
        code:
          $ref: '#/components/schemas/ErrorCode'
        description:
          $ref: '#/components/schemas/ErrorDescription'
      required:
        - code
        - description
      example:
        code: "01000000F"
        description: "Wrong party identifier"

    GpdMessage:
      type: object
      description: >
        GPD message representing an event related to a payment position.
        The message drives the creation, update, or deletion of a Request To Pay (RTP).
      required:
        - id
        - operation
        - timestamp
      properties:
        id:
          type: integer
          format: int64
          minimum: 1
          description: Unique identifier of the GPD message
        operation:
          $ref: '#/components/schemas/GpdOperation'
        timestamp:
          type: integer
          format: int64
          minimum: 1
          description: Epoch timestamp of the message creation
        iuv:
          type: string
          pattern: "^\\d{15,17}$"
          description: IUV identifier (15 to 17 digits)
        subject:
          type: string
          maxLength: 140
        description:
          type: string
          maxLength: 140
        ec_tax_code:
          type: string
          pattern: "^(\\d{11}|\\d{16})$"
        debtor_tax_code:
          type: string
          pattern: "^(([A-Z]{6}\\d{2}[A-Z]\\d{2}[A-Z]\\d{3}[A-Z])|(\\d{11}))$"
        nav:
          type: string
          minLength: 15
          maxLength: 30
        due_date:
          type: integer
          format: int64
          minimum: 1
        amount:
          $ref: "#/components/schemas/GpdAmountEuroCents"
        status:
          $ref: '#/components/schemas/GpdStatus'
        psp_code:
          type: string
          maxLength: 50
        psp_tax_code:
          type: string
          maxLength: 50
      example:
        id: 123456
        operation: CREATE
        timestamp: 1735689600000
        iuv: "123456789012345"
        subject: "TARI 2025"
        description: "Municipal waste tax payment"
        ec_tax_code: "77777777777"
        debtor_tax_code: "RSSMRA85M01H501U"
        nav: "3123456789012345"
        due_date: 1767225600000
        amount: 35000
        status: VALID
        psp_code: "PSP01"
        psp_tax_code: "12345678901"

    GpdOperation:
      type: string
      description: >
        Type of operation requested by the GPD message, defining how the RTP
        should be processed.
      enum:
        - CREATE
        - UPDATE
        - DELETE
      example: CREATE

    GpdStatus:
      type: string
      description: >
        Current business status of the GPD message, reflecting the lifecycle
        state of the underlying payment position.
      enum:
        - VALID
        - PARTIALLY_PAID
        - PAID
        - EXPIRED
        - INVALID
        - DRAFT
        - PUBLISHED
        - NULL
      example: VALID

    MalformedRequestErrorResponse:
      type: object
      properties:
        error:
          type: string
          example: "Malformed request"
        details:
          type: string
          example: "The request is malformed. Please check the request's body and try again."

    MismatchActivationErrorResponse:
      type: object
      properties:
        error:
          type: string
          example: "Debtor's fiscal code is not activated"
        details:
          type: string
          example: "The debtor's fiscal code provided is not activated by thr subject making the request."

    RequestId:
      description: Identifier of the request.
      type: string
      format: uuid
      pattern: "^[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}$"
      minLength: 36
      maxLength: 36
      example: "bd615b4a-066d-443e-8dd2-a28a39931fef"

    Version:
      description: Version of the required API.
      type: string
      pattern: "^[ -~]{1,64}$"
      minLength: 1
      maxLength: 64
      example: "v1"

  responses:
    RtpDeliveryStatus:
      description: RTP successfully retrieved by NoticeNumber and PayeeId.
      headers:
        Access-Control-Allow-Origin:
          description: |
            Indicates whether the response can be shared with requesting code
            from the given origin.
          required: false
          schema:
            $ref: '#/components/schemas/AccessControlAllowOrigin'
        RateLimit-Limit:
          description: The number of allowed requests in the current period.
          required: false
          schema:
            $ref: '#/components/schemas/RateLimitLimit'
        RateLimit-Reset:
          description: The number of seconds left in the current period.
          required: false
          schema:
            $ref: '#/components/schemas/RateLimitReset'
        Retry-After:
          description: |
            The number of seconds to wait before allowing a follow-up request.
          required: false
          schema:
            $ref: '#/components/schemas/RetryAfter'
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/RtpDeliveryResponse'

    NoContent:
      description: Response returned when there isn't a content to return.
      headers:
        Access-Control-Allow-Origin:
          description: |
            Indicates whether the response can be shared with requesting code
            from the given origin.
          required: false
          schema:
            $ref: '#/components/schemas/AccessControlAllowOrigin'
        RateLimit-Limit:
          description: The number of allowed requests in the current period.
          required: false
          schema:
            $ref: '#/components/schemas/RateLimitLimit'
        RateLimit-Reset:
          description: The number of seconds left in the current period
          required: false
          schema:
            $ref: '#/components/schemas/RateLimitReset'
        Retry-After:
          description: |
            The number of seconds to wait before allowing a follow-up request.
          required: false
          schema:
            $ref: '#/components/schemas/RetryAfter'

    RtpListByNoticeNumber:
      description: RTPs successfully retrieved by notice number.
      headers:
        Access-Control-Allow-Origin:
          description: |
            Indicates whether the response can be shared with requesting code
            from the given origin.
          required: false
          schema:
            $ref: '#/components/schemas/AccessControlAllowOrigin'
        RateLimit-Limit:
          description: The number of allowed requests in the current period.
          required: false
          schema:
            $ref: '#/components/schemas/RateLimitLimit'
        RateLimit-Reset:
          description: The number of seconds left in the current period.
          required: false
          schema:
            $ref: '#/components/schemas/RateLimitReset'
        Retry-After:
          description: |
            The number of seconds to wait before allowing a follow-up request.
          required: false
          schema:
            $ref: '#/components/schemas/RetryAfter'
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/RtpList'

    findRtp:
      description: RTP successfully retrieved by ID.
      headers:
        Access-Control-Allow-Origin:
          description: |
            Indicates whether the response can be shared with requesting code
            from the given origin.
          required: false
          schema:
            $ref: '#/components/schemas/AccessControlAllowOrigin'
        RateLimit-Limit:
          description: The number of allowed requests in the current period.
          required: false
          schema:
            $ref: '#/components/schemas/RateLimitLimit'
        RateLimit-Reset:
          description: The number of seconds left in the current period.
          required: false
          schema:
            $ref: '#/components/schemas/RateLimitReset'
        Retry-After:
          description: |
            The number of seconds to wait before allowing a follow-up request.
          required: false
          schema:
            $ref: '#/components/schemas/RetryAfter'
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Rtp'

    Error:
      description: Response returned when an error occured.
      headers:
        Access-Control-Allow-Origin:
          description: |
            Indicates whether the response can be shared with requesting code
            from the given origin.
          required: false
          schema:
            $ref: '#/components/schemas/AccessControlAllowOrigin'
        RateLimit-Limit:
          description: The number of allowed requests in the current period.
          required: false
          schema:
            $ref: '#/components/schemas/RateLimitLimit'
        RateLimit-Reset:
          description: The number of seconds left in the current period
          required: false
          schema:
            $ref: '#/components/schemas/RateLimitReset'
        Retry-After:
          description: |
            The number of seconds to wait before allowing a follow-up request.
          required: false
          schema:
            $ref: '#/components/schemas/RetryAfter'
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Errors'
        text/*:
          schema:
            type: string
            pattern: "^[ -~]{0,65535}$"
            maxLength: 65535

    RtpResponse:
      description: RTP resulting from the processed GPD message
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Rtp'

    UnauthorizedError:
      description: >
        Returned when the request is missing a valid OAuth2 access token,
        or when the token is expired or malformed.
      headers:
        WWW-Authenticate:
          description: |
            Indicates the authentication scheme(s) and parameters required to access a protected resource.
          required: false
          schema:
            $ref: '#/components/schemas/WWWAuthenticate'
      content:
        text/*:
          schema:
            type: string
            pattern: "^[ -~]{0,65535}$"
            maxLength: 65535

    ForbiddenError:
      description: >
        Returned when the authenticated client does not have sufficient
        permissions (OAuth2 scopes) to access this resource.
      headers:
        Access-Control-Allow-Origin:
          description: |
            Indicates whether the response can be shared with requesting code
            from the given origin.
          required: false
          schema:
            $ref: '#/components/schemas/AccessControlAllowOrigin'
        RateLimit-Limit:
          description: The number of allowed requests in the current period.
          required: false
          schema:
            $ref: '#/components/schemas/RateLimitLimit'
        RateLimit-Reset:
          description: The number of seconds left in the current period.
          required: false
          schema:
            $ref: '#/components/schemas/RateLimitReset'

    ConflictError:
      description: >
        Returned when the requested RTP operation cannot be completed due to a conflict
        with the current RTP state (for example, an already active payer).
      headers:
        Access-Control-Allow-Origin:
          description: |
            Indicates whether the response can be shared with requesting code
            from the given origin.
          required: false
          schema:
            $ref: '#/components/schemas/AccessControlAllowOrigin'
        RateLimit-Limit:
          description: The number of allowed requests in the current period.
          required: false
          schema:
            $ref: '#/components/schemas/RateLimitLimit'
        RateLimit-Reset:
          description: The number of seconds left in the current period.
          required: false
          schema:
            $ref: '#/components/schemas/RateLimitReset'
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Errors'

    GenericError:
      description: >
        Standard error response returned by the service when an unexpected
        or unclassified error occurs.
      headers:
        Access-Control-Allow-Origin:
          description: |
            Indicates whether the response can be shared with requesting code
            from the given origin.
          required: false
          schema:
            $ref: '#/components/schemas/AccessControlAllowOrigin'
        RateLimit-Limit:
          description: The number of allowed requests in the current period.
          required: false
          schema:
            $ref: '#/components/schemas/RateLimitLimit'
        RateLimit-Reset:
          description: The number of seconds left in the current period
          required: false
          schema:
            $ref: '#/components/schemas/RateLimitReset'
        Retry-After:
          description: |
            The number of seconds to wait before allowing a follow-up request.
          required: false
          schema:
            $ref: '#/components/schemas/RetryAfter'
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/GenericError'
        text/*:
          schema:
            type: string
            pattern: "^[ -~]{0,65535}$"
            maxLength: 65535

    ErrorResponse:
      description: Response returned when an error occurred.
      headers:
        Access-Control-Allow-Origin:
          description: |
            Indicates whether the response can be shared with requesting code
            from the given origin.
          required: false
          schema:
            $ref: '#/components/schemas/AccessControlAllowOrigin'
        RateLimit-Limit:
          description: The number of allowed requests in the current period.
          required: false
          schema:
            $ref: '#/components/schemas/RateLimitLimit'
        RateLimit-Reset:
          description: The number of seconds left in the current period
          required: false
          schema:
            $ref: '#/components/schemas/RateLimitReset'
        Retry-After:
          description: |
            The number of seconds to wait before allowing a follow-up request.
          required: false
          schema:
            $ref: '#/components/schemas/RetryAfter'
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Errors'
        text/*:
          schema:
            type: string
            pattern: "^[ -~]{0,65535}$"
            maxLength: 65535



  parameters:

    RequestId:
      name: RequestId
      in: header
      description: Identifier of the request.
      required: true
      schema:
        $ref: '#/components/schemas/RequestId'

    NoticeNumber:
      name: noticeNumber
      in: query
      description: Notice number associated to a RTP.
      required: true
      schema:
        $ref: '#/components/schemas/NoticeNumber'

    RtpId:
      name: rtpId
      in: path
      description: Identifier of a RTP.
      required: true
      schema:
        $ref: '#/components/schemas/RtpId'

    Version:
      name: Version
      in: header
      description: Version of the required API.
      required: false
      schema:
        $ref: '#/components/schemas/Version'

    Idempotency-Key:
      name: Idempotency-Key
      in: header
      description: Client-generated UUID to ensure idempotent retries.
      required: true
      schema:
        $ref: '#/components/schemas/RequestId'
      example: "4632ef6e-3c72-4b50-9e2f-09bc57fd544c"

    payeeId:
      name: payeeId
      in: query
      description: The payee id (e.g. EC fiscal code)
      required: true
      schema:
        $ref: "#/components/schemas/PayeeId"

  securitySchemes:
    oAuth2:
      type: oauth2
      description: >
        OAuth 2.0 authorization using JWT access tokens.
        Tokens must include the required scopes to invoke RTP APIs.
      flows:
        clientCredentials:
          tokenUrl: /token
          refreshUrl: /token
          scopes:
            admin_rtp_send: Administrative permission to manage RTP lifecycle
            read_rtp_send: Permission to read RTP data
            write_rtp_send: Permission to write/manage RTP data
            process_rtp_send: Permission to process GPD messages into RTP operations
            payee_read_rtp: Allows payee to read RTP delivery status for its own debt positions

    oauth2:
      type: oauth2
      description: >
        OAuth 2.0 authorization using JWT access tokens.
        Tokens must include the required scopes to invoke RTP processing APIs.
      flows:
        clientCredentials:
          tokenUrl: /token
          refreshUrl: /token
          scopes:
            admin_rtp_send: Administrative permission to manage RTP lifecycle
            process_rtp_send: Permission to process GPD messages into RTP operations
