openapi: 3.0.1
info:
  title: IDPAY ITN Welfare Organization Portal Merchant API
  description: IDPAY ITN Welfare Organization Portal Merchant API
  version: '1.0'
  contact:
    name: PagoPA – IDPAY
    email: idpay-support@pagopa.it
    url: https://www.pagopa.gov.it/
servers:
  - url: https://api-io.dev.cstar.pagopa.it/idpay-itn/merchant
    description: DEV
    x-internal: false
tags:
  - name: merchant-upload
    description: Upload CSV merchants
  - name: merchant-list
    description: List merchants
  - name: merchant-detail
    description: Merchant detail by initiative
  - name: merchant-initiative-statistics
    description: Statistics for merchant on initiative
  - name: merchant-transactions
    description: Merchant transactions
  - name: reported-user
    description: Reported users management
paths:
  /initiative/{initiativeId}/upload:
    put:
      tags: [ merchant-upload ]
      summary: Upload CSV file containing a list of merchants
      description: "ENG: Upload CSV file containing a list of merchants <br> IT: Caricamento del file CSV conentente una lista di esercenti"
      operationId: uploadMerchantList
      parameters:
        - name: initiativeId
          in: path
          description: The initiative ID
          required: true
          schema:
            type: string
            maxLength: 64
            pattern: '^[A-Z0-9\-_]+$'
      requestBody:
        content:
          multipart/form-data:
            schema:
              required: [ file ]
              type: object
              properties:
                file:
                  type: string
                  format: binary
                  description: CSV file (max 10MB)
                  maxLength: 10485760
      responses:
        "200":
          description: Ok
          headers:
            X-RateLimit-Limit: { $ref: '#/components/headers/X-RateLimit-Limit' }
            X-RateLimit-Remaining: { $ref: '#/components/headers/X-RateLimit-Remaining' }
            X-RateLimit-Reset: { $ref: '#/components/headers/X-RateLimit-Reset' }
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MerchantUpdateDTO'
        '400':
          description: Bad request
          headers:
            X-RateLimit-Limit: { $ref: '#/components/headers/X-RateLimit-Limit' }
            X-RateLimit-Remaining: { $ref: '#/components/headers/X-RateLimit-Remaining' }
            X-RateLimit-Reset: { $ref: '#/components/headers/X-RateLimit-Reset' }
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MerchantErrorDTO'
              example:
                code: MERCHANT_INVALID_REQUEST
                message: Something went wrong handling request
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /initiative/{initiativeId}/merchants:
    get:
      tags: [ merchant-list ]
      summary: Returns the merchants list
      description: "ENG: Returns the merchants list <br> IT: Lista degli esercenti"
      operationId: getMerchantList
      parameters:
        - name: initiativeId
          in: path
          description: The initiative ID
          required: true
          schema:
            type: string
            maxLength: 64
            pattern: '^[A-Z0-9\-_]+$'
        - name: page
          in: query
          required: false
          schema:
            type: integer
            format: int32
            minimum: 0
            maximum: 100000
        - name: size
          in: query
          required: false
          schema:
            type: integer
            format: int32
            minimum: 1
            maximum: 1000
        - name: sort
          in: query
          required: false
          schema:
            type: string
            maxLength: 128
            pattern: '^[A-Za-z0-9_,.\- ]+$'
        - name: fiscalCode
          in: query
          description: Fiscal Code
          required: false
          schema:
            type: string
            maxLength: 16
            pattern: '^[A-Z0-9]{11,16}$'
      responses:
        '200':
          description: Ok
          headers:
            X-RateLimit-Limit: { $ref: '#/components/headers/X-RateLimit-Limit' }
            X-RateLimit-Remaining: { $ref: '#/components/headers/X-RateLimit-Remaining' }
            X-RateLimit-Reset: { $ref: '#/components/headers/X-RateLimit-Reset' }
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MerchantListDTO'
        '400':
          description: Bad request
          headers:
            X-RateLimit-Limit: { $ref: '#/components/headers/X-RateLimit-Limit' }
            X-RateLimit-Remaining: { $ref: '#/components/headers/X-RateLimit-Remaining' }
            X-RateLimit-Reset: { $ref: '#/components/headers/X-RateLimit-Reset' }
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MerchantErrorDTO'
              example:
                code: MERCHANT_INVALID_REQUEST
                message: Something went wrong handling request
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /{merchantId}/initiative/{initiativeId}:
    get:
      tags: [ merchant-detail ]
      summary: Returns the merchants detail on initiative
      description: "ENG: Returns the merchant detail on initiative <br> IT: Dettaglio dell' esercente sull'iniziativa"
      operationId: getMerchantDetail
      parameters:
        - name: initiativeId
          in: path
          description: The initiative ID
          required: true
          schema:
            type: string
            maxLength: 64
            pattern: '^[A-Z0-9\-_]+$'
        - name: merchantId
          in: path
          description: The merchant ID
          required: true
          schema:
            type: string
            maxLength: 64
            pattern: '^[A-Z0-9\-_]+$'
      responses:
        '200':
          description: Ok
          headers:
            X-RateLimit-Limit: { $ref: '#/components/headers/X-RateLimit-Limit' }
            X-RateLimit-Remaining: { $ref: '#/components/headers/X-RateLimit-Remaining' }
            X-RateLimit-Reset: { $ref: '#/components/headers/X-RateLimit-Reset' }
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MerchantDetailDTO'
        '400':
          description: Bad request
          headers:
            X-RateLimit-Limit: { $ref: '#/components/headers/X-RateLimit-Limit' }
            X-RateLimit-Remaining: { $ref: '#/components/headers/X-RateLimit-Remaining' }
            X-RateLimit-Reset: { $ref: '#/components/headers/X-RateLimit-Reset' }
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MerchantErrorDTO'
              example:
                code: MERCHANT_INVALID_REQUEST
                message: Something went wrong handling request
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: The requested ID was not found
          headers:
            X-RateLimit-Limit: { $ref: '#/components/headers/X-RateLimit-Limit' }
            X-RateLimit-Remaining: { $ref: '#/components/headers/X-RateLimit-Remaining' }
            X-RateLimit-Reset: { $ref: '#/components/headers/X-RateLimit-Reset' }
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MerchantErrorDTO'
              example:
                code: MERCHANT_NOT_ONBOARDED
                message: The current merchant is not onboarded on initiative
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /{merchantId}/initiative/{initiativeId}/statistics:
    get:
      tags: [ merchant-initiative-statistics ]
      summary: Returns the merchant statistics on the initiative
      description: Returns the merchant statistics on the initiative
      operationId: getMerchantInitiativeStatistics
      parameters:
        - name: merchantId
          in: path
          description: The merchant ID
          required: true
          schema:
            type: string
            maxLength: 64
            pattern: '^[A-Z0-9\-_]+$'
        - name: initiativeId
          in: path
          description: The initiative ID
          required: true
          schema:
            type: string
            maxLength: 64
            pattern: '^[A-Z0-9\-_]+$'
      responses:
        '200':
          description: Ok
          headers:
            X-RateLimit-Limit: { $ref: '#/components/headers/X-RateLimit-Limit' }
            X-RateLimit-Remaining: { $ref: '#/components/headers/X-RateLimit-Remaining' }
            X-RateLimit-Reset: { $ref: '#/components/headers/X-RateLimit-Reset' }
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MerchantStatisticsDTO'
        '400':
          description: Bad request
          headers:
            X-RateLimit-Limit: { $ref: '#/components/headers/X-RateLimit-Limit' }
            X-RateLimit-Remaining: { $ref: '#/components/headers/X-RateLimit-Remaining' }
            X-RateLimit-Reset: { $ref: '#/components/headers/X-RateLimit-Reset' }
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatisticsErrorDTO'
              example:
                code: "STATISTICS_INVALID_REQUEST"
                message: "Something went wrong handling request"
        '401':
          description: Authentication failed
          headers:
            X-RateLimit-Limit: { $ref: '#/components/headers/X-RateLimit-Limit' }
            X-RateLimit-Remaining: { $ref: '#/components/headers/X-RateLimit-Remaining' }
            X-RateLimit-Reset: { $ref: '#/components/headers/X-RateLimit-Reset' }
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatisticsErrorDTO'
        '404':
          description: The requested ID was not found
          headers:
            X-RateLimit-Limit: { $ref: '#/components/headers/X-RateLimit-Limit' }
            X-RateLimit-Remaining: { $ref: '#/components/headers/X-RateLimit-Remaining' }
            X-RateLimit-Reset: { $ref: '#/components/headers/X-RateLimit-Reset' }
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatisticsErrorDTO'
              example:
                code: "STATISTICS_NOT_FOUND"
                message: "Stats not found"
        '429':
          description: Too many Request
          headers:
            X-RateLimit-Limit: { $ref: '#/components/headers/X-RateLimit-Limit' }
            X-RateLimit-Remaining: { $ref: '#/components/headers/X-RateLimit-Remaining' }
            X-RateLimit-Reset: { $ref: '#/components/headers/X-RateLimit-Reset' }
            Retry-After: { $ref: '#/components/headers/Retry-After' }
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatisticsErrorDTO'
              example:
                code: "STATISTICS_TOO_MANY_REQUESTS"
                message: "Too many requests"
        '500':
          description: Server ERROR
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatisticsErrorDTO'
              example:
                code: "STATISTICS_GENERIC_ERROR"
                message: "Application error"
  /{merchantId}/initiative/{initiativeId}/transactions:
    get:
      tags: [ merchant-transactions ]
      summary: Returns the list of in progress transactions associated to a merchant
      description: "ENG: Returns the list of in progress transactions associated to a merchant <br> IT: Ritorna la lista delle transazioni in corso associate ad un esercente"
      operationId: getMerchantTransactions
      parameters:
        - name: merchantId
          in: path
          description: The merchant ID
          required: true
          schema:
            type: string
            maxLength: 64
            pattern: '^[A-Z0-9\-_]+$'
        - name: initiativeId
          in: path
          description: The initiative ID
          required: true
          schema:
            type: string
            maxLength: 64
            pattern: '^[A-Z0-9\-_]+$'
        - name: page
          in: query
          required: false
          schema:
            type: integer
            format: int32
            minimum: 0
            maximum: 100000
        - name: size
          in: query
          required: false
          schema:
            type: integer
            format: int32
            minimum: 1
            maximum: 1000
        - name: fiscalCode
          in: query
          description: Fiscal Code
          required: false
          schema:
            type: string
            maxLength: 16
            pattern: '^[A-Z0-9]{11,16}$'
        - name: status
          in: query
          description: Transaction status
          required: false
          schema:
            type: string
            maxLength: 32
      responses:
        '200':
          description: Ok
          headers:
            X-RateLimit-Limit: { $ref: '#/components/headers/X-RateLimit-Limit' }
            X-RateLimit-Remaining: { $ref: '#/components/headers/X-RateLimit-Remaining' }
            X-RateLimit-Reset: { $ref: '#/components/headers/X-RateLimit-Reset' }
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MerchantTransactionsListDTO'
        '400':
          description: Bad request
          headers:
            X-RateLimit-Limit: { $ref: '#/components/headers/X-RateLimit-Limit' }
            X-RateLimit-Remaining: { $ref: '#/components/headers/X-RateLimit-Remaining' }
            X-RateLimit-Reset: { $ref: '#/components/headers/X-RateLimit-Reset' }
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TransactionErrorDTO'
              example:
                code: "PAYMENT_INVALID_REQUEST"
                message: "Something went wrong handling the request"
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /{merchantId}/initiative/{initiativeId}/transactions/processed:
    get:
      tags: [ merchant-transactions ]
      summary: Returns the list of processed transactions associated to a merchant
      description: "ENG: Returns the list of processed transactions associated to a merchant <br> IT: Ritorna la lista delle transazioni processate associate ad un esercente"
      operationId: getMerchantTransactionsProcessed
      parameters:
        - name: merchantId
          in: path
          description: The merchant ID
          required: true
          schema:
            type: string
            maxLength: 64
            pattern: '^[A-Z0-9\-_]+$'
        - name: initiativeId
          in: path
          description: The initiative ID
          required: true
          schema:
            type: string
            maxLength: 64
            pattern: '^[A-Z0-9\-_]+$'
        - name: page
          in: query
          required: false
          schema:
            type: integer
            format: int32
            minimum: 0
            maximum: 100000
        - name: size
          in: query
          required: false
          schema:
            type: integer
            format: int32
            minimum: 1
            maximum: 1000
        - name: fiscalCode
          in: query
          description: Fiscal Code
          required: false
          schema:
            type: string
            maxLength: 16
            pattern: '^[A-Z0-9]{11,16}$'
        - name: status
          in: query
          description: Transaction status
          required: false
          schema:
            type: string
            maxLength: 32
      responses:
        '200':
          description: Ok
          headers:
            X-RateLimit-Limit: { $ref: '#/components/headers/X-RateLimit-Limit' }
            X-RateLimit-Remaining: { $ref: '#/components/headers/X-RateLimit-Remaining' }
            X-RateLimit-Reset: { $ref: '#/components/headers/X-RateLimit-Reset' }
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MerchantTransactionsProcessedListDTO'
        '400':
          description: Bad request
          headers:
            X-RateLimit-Limit: { $ref: '#/components/headers/X-RateLimit-Limit' }
            X-RateLimit-Remaining: { $ref: '#/components/headers/X-RateLimit-Remaining' }
            X-RateLimit-Reset: { $ref: '#/components/headers/X-RateLimit-Reset' }
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TransactionErrorDTO'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Merchant not found
          headers:
            X-RateLimit-Limit: { $ref: '#/components/headers/X-RateLimit-Limit' }
            X-RateLimit-Remaining: { $ref: '#/components/headers/X-RateLimit-Remaining' }
            X-RateLimit-Reset: { $ref: '#/components/headers/X-RateLimit-Reset' }
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
  /reportedUser:
    post:
      tags: [ reported-user ]
      summary: Create reported user
      description: "ENG: Flag a user (fiscal code) for a merchant/initiative pair <br> IT: Segnala un utente (CF) per coppia merchant/iniziativa"
      operationId: createReportedUser
      security:
        - Bearer: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReportedUserRequestDTO'
            examples:
              createReportedUser:
                value:
                  merchantId: "MERCHANT_12345"
                  initiativeId: "INITIATIVE_67890"
                  userFiscalCode: "RSSMRA85T10A562S"
      responses:
        '200':
          description: Business outcome
          headers:
            X-RateLimit-Limit: { $ref: '#/components/headers/X-RateLimit-Limit' }
            X-RateLimit-Remaining: { $ref: '#/components/headers/X-RateLimit-Remaining' }
            X-RateLimit-Reset: { $ref: '#/components/headers/X-RateLimit-Reset' }
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReportedUserCreateResponseDTO'
              examples:
                ok:
                  value: { status: "OK", errorKey: "" }
                alreadyReported:
                  value: { status: "KO", errorKey: "Already reported" }
        '400':
          description: Bad request
          headers:
            X-RateLimit-Limit: { $ref: '#/components/headers/X-RateLimit-Limit' }
            X-RateLimit-Remaining: { $ref: '#/components/headers/X-RateLimit-Remaining' }
            X-RateLimit-Reset: { $ref: '#/components/headers/X-RateLimit-Reset' }
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorDTO'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: Not authorized
          headers:
            X-RateLimit-Limit: { $ref: '#/components/headers/X-RateLimit-Limit' }
            X-RateLimit-Remaining: { $ref: '#/components/headers/X-RateLimit-Remaining' }
            X-RateLimit-Reset: { $ref: '#/components/headers/X-RateLimit-Reset' }
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorDTO'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
    get:
      tags: [ reported-user ]
      summary: Search reported users
      description: "ENG: Search reported users by optional filters <br> IT: Ricerca segnalazioni con filtri opzionali"
      operationId: searchReportedUsers
      security:
        - Bearer: [ ]
      parameters:
        - name: merchantId
          in: query
          required: false
          schema: { type: string, maxLength: 64, pattern: '^[A-Z0-9\-_]+$' }
          description: Merchant ID
          example: MERCHANT_12345
        - name: initiativeId
          in: query
          required: false
          schema: { type: string, maxLength: 64, pattern: '^[A-Z0-9\-_]+$' }
          description: Initiative ID
          example: INITIATIVE_67890
        - name: userFiscalCode
          in: query
          required: false
          schema:
            type: string
            maxLength: 16
            pattern: '^[A-Z0-9]{11,16}$'
          description: Citizen fiscal code
          example: RSSMRA85T10A562S
      responses:
        '200':
          description: Ok
          headers:
            X-RateLimit-Limit: { $ref: '#/components/headers/X-RateLimit-Limit' }
            X-RateLimit-Remaining: { $ref: '#/components/headers/X-RateLimit-Remaining' }
            X-RateLimit-Reset: { $ref: '#/components/headers/X-RateLimit-Reset' }
          content:
            application/json:
              schema:
                type: array
                maxItems: 1000
                items:
                  $ref: '#/components/schemas/ReportedUserDTO'
              examples:
                list:
                  value:
                    - fiscalCode: "RSSMRA85T10A562S"
                      reportedDate: "2025-10-30T09:15:12Z"
                      transactionId: "TRX_001"
                      transactionDate: "2025-10-30T09:14:50Z"
                    - fiscalCode: "VRDLGI90A01H501Z"
                      reportedDate: "2025-10-29T16:02:45Z"
                      transactionId: "TRX_002"
                      transactionDate: "2025-10-29T15:59:10Z"
        '400':
          description: Bad request
          headers:
            X-RateLimit-Limit: { $ref: '#/components/headers/X-RateLimit-Limit' }
            X-RateLimit-Remaining: { $ref: '#/components/headers/X-RateLimit-Remaining' }
            X-RateLimit-Reset: { $ref: '#/components/headers/X-RateLimit-Reset' }
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorDTO'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
    delete:
      tags: [ reported-user ]
      summary: Delete reported user
      description: "ENG: Remove a report for the given fiscal code <br> IT: Rimuove la segnalazione per il codice fiscale indicato"
      operationId: deleteReportedUser
      security:
        - Bearer: [ ]
      parameters:
        - name: userFiscalCode
          in: query
          required: false
          schema:
            type: string
            maxLength: 16
            pattern: '^[A-Z0-9]{11,16}$'
          description: Citizen fiscal code of the reported user
          example: RSSMRA85T10A562S
      responses:
        '200':
          description: Business outcome
          headers:
            X-RateLimit-Limit: { $ref: '#/components/headers/X-RateLimit-Limit' }
            X-RateLimit-Remaining: { $ref: '#/components/headers/X-RateLimit-Remaining' }
            X-RateLimit-Reset: { $ref: '#/components/headers/X-RateLimit-Reset' }
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReportedUserCreateResponseDTO'
              examples:
                ok:
                  value: { status: "OK", errorKey: "" }
                notFound:
                  value: { status: "KO", errorKey: "UserId not found" }
                entityNotFound:
                  value: { status: "KO", errorKey: "Entity not found" }
                serviceUnavailable:
                  value: { status: "KO", errorKey: "Service unavailable" }
                differentMerchant:
                  value: { status: "KO", errorKey: "Different Merchant Id" }
                differentInitiative:
                  value: { status: "KO", errorKey: "Different Initiative Id" }
        '400':
          description: Bad request
          headers:
            X-RateLimit-Limit: { $ref: '#/components/headers/X-RateLimit-Limit' }
            X-RateLimit-Remaining: { $ref: '#/components/headers/X-RateLimit-Remaining' }
            X-RateLimit-Reset: { $ref: '#/components/headers/X-RateLimit-Reset' }
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorDTO'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: Not authorized
          headers:
            X-RateLimit-Limit: { $ref: '#/components/headers/X-RateLimit-Limit' }
            X-RateLimit-Remaining: { $ref: '#/components/headers/X-RateLimit-Remaining' }
            X-RateLimit-Reset: { $ref: '#/components/headers/X-RateLimit-Reset' }
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorDTO'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'
components:
  securitySchemes:
    Bearer:
      type: apiKey
      name: Authorization
      in: header
  headers:
    X-RateLimit-Limit:
      description: Numero massimo di richieste consentite nella finestra corrente.
      schema: { type: integer, minimum: 0 }
    X-RateLimit-Remaining:
      description: Richieste residue disponibili nella finestra.
      schema: { type: integer, minimum: 0 }
    X-RateLimit-Reset:
      description: Epoch second in cui la finestra si resetta.
      schema: { type: integer, minimum: 0 }
    Retry-After:
      description: Secondi da attendere prima del prossimo tentativo.
      schema: { type: integer, minimum: 0 }
  responses:
    UnauthorizedError:
      description: Authentication failed
      headers:
        X-RateLimit-Limit: { $ref: '#/components/headers/X-RateLimit-Limit' }
        X-RateLimit-Remaining: { $ref: '#/components/headers/X-RateLimit-Remaining' }
        X-RateLimit-Reset: { $ref: '#/components/headers/X-RateLimit-Reset' }
      content:
        application/json:
          schema: { $ref: '#/components/schemas/ErrorDTO' }
    InternalServerError:
      description: Server error
      content:
        application/json:
          schema: { $ref: '#/components/schemas/ErrorDTO' }
    TooManyRequests:
      description: Too many requests
      headers:
        X-RateLimit-Limit: { $ref: '#/components/headers/X-RateLimit-Limit' }
        X-RateLimit-Remaining: { $ref: '#/components/headers/X-RateLimit-Remaining' }
        X-RateLimit-Reset: { $ref: '#/components/headers/X-RateLimit-Reset' }
        Retry-After: { $ref: '#/components/headers/Retry-After' }
      content:
        application/json:
          schema: { $ref: '#/components/schemas/ErrorDTO' }
  schemas:
    MerchantUpdateDTO:
      type: object
      properties:
        status:
          type: string
          description: "ENG: Upload file status <br>IT: Stato di caricamento del file"
          maxLength: 32
          enum: [ OK, KO ]
        errorRow:
          type: integer
          format: int32
          minimum: 0
          maximum: 1000000
          description: "ENG: Row where an error occurs during file uploading <br>IT: Riga alla quale c'è stato un errore durante il caricamento del file"
        errorKey:
          type: string
          maxLength: 256
          description: "ENG: Error Key: <ul><li>merchant.invalid.file.format: file format not valid</li><li>merchant.invalid.file.empty: empty file</li><li>merchant.invalid.file.size: file size exceeds limit</li><li>merchant.invalid.file.acquirer.wrong: inserted acquirer Id doesn't correspond to the one expected</li><li>merchant.invalid.file.vat.wrong: VAT Number or fiscal code not valid</li><li>merchant.invalid.file.iban.wrong: IBAN not valid</li></ul><br>IT: Chiave di errore: <ul><li>merchant.invalid.file.format: formato del file non valido</li><li>merchant.invalid.file.empty: file vuoto</li><li>merchant.invalid.file.size: la dimensione del file supera il limite consentito<li>merchant.invalid.file.acquirer.wrong: l'acquirer Id inserito non corrisponde a quello atteso</li></li><li>merchant.invalid.file.vat.wrong: partita IVA o CF non valido</li><li>merchant.invalid.file.iban.wrong: IBAN non valido</li></ul>"
        elabTimeStamp:
          type: string
          format: date-time
          maxLength: 64
          description: "ENG: Time and date of file elaboration <br>IT: Data e ora dell'elaborazione del file"
    MerchantListDTO:
      type: object
      properties:
        content:
          type: array
          maxItems: 1000
          items:
            $ref: '#/components/schemas/MerchantDTO'
        pageNo:
          type: integer
          format: int32
          minimum: 0
          maximum: 100000
          description: "ENG: The number of the page <br> IT: Il numero della pagina"
        pageSize:
          type: integer
          format: int32
          minimum: 1
          maximum: 1000
          description: "ENG: The element size for page <br> IT: Il numero di elementi per pagina"
        totalElements:
          type: integer
          format: int32
          minimum: 0
          maximum: 1000000000
          description: "ENG: The total number of the elements <br> IT: Il numero totale degli elementi"
        totalPages:
          type: integer
          format: int32
          minimum: 0
          maximum: 100000
          description: "ENG: The total number of the pages <br> IT: Il numero totale delle pagine"
    MerchantDTO:
      type: object
      properties:
        merchantId:
          type: string
          maxLength: 64
          pattern: '^[A-Z0-9\-_]+$'
          description: "ENG: The ID of the merchant <br> IT: L'ID' dell'esercente"
        businessName:
          type: string
          maxLength: 256
          description: "ENG: The name of the merchant <br> IT: La ragione sociale dell'esercente"
        fiscalCode:
          type: string
          maxLength: 16
          pattern: '^[A-Z0-9]{11,16}$'
          description: "ENG: The fiscal code/vat number of the merchant <br> IT: Il codice fiscale/partita iva dell'esercente"
        merchantStatus:
          type: string
          enum: [ UPLOADED ]
          description: "ENG: One of the possible merchant onboarding status: <ul><li>UPLOADED:This is the initial status after the csv upload</li></ul>IT: Uno dei possibili stati dell'onboarding da parte dell'esercente: <ul><li>UPLOADED:Questo è lo stato iniziale dopo il caricamento del file csv</li></ul>"
        updateStatusDate:
          type: string
          format: date-time
          maxLength: 64
          description: "ENG: Time and date of the last status update <br> IT: La data ed ora dell'ultimo aggiornamento dello stato"
    MerchantTransactionsListDTO:
      type: object
      required:
        - content
        - pageNo
        - pageSize
        - totalElements
        - totalPages
      properties:
        content:
          type: array
          maxItems: 1000
          items:
            $ref: '#/components/schemas/MerchantTransactionDTO'
        pageNo:
          type: integer
          format: int32
          minimum: 0
          maximum: 100000
        pageSize:
          type: integer
          format: int32
          minimum: 1
          maximum: 1000
        totalElements:
          type: integer
          format: int32
          minimum: 0
          maximum: 1000000000
        totalPages:
          type: integer
          format: int32
          minimum: 0
          maximum: 100000
    MerchantTransactionDTO:
      type: object
      required:
        - trxCode
        - trxId
        - effectiveAmountCents
        - trxExpirationSeconds
        - status
      properties:
        trxCode:
          type: string
          maxLength: 64
          description: "ENG: Transaction code - IT: Il codice della transazione"
        trxId:
          type: string
          maxLength: 64
          description: "ENG: Transaction ID - IT: L'ID della transazione"
        fiscalCode:
          type: string
          maxLength: 16
          pattern: '^[A-Z0-9]{11,16}$'
          description: "ENG: Citizen fiscal code - IT: Codice fiscale del cittadino"
        effectiveAmountCents:
          type: integer
          format: int64
          minimum: 0
          maximum: 9000000000000000000
          description: "ENG: Transaction amount - IT: Quantitativo della transazione"
          example: 100
        rewardAmountCents:
          type: integer
          format: int64
          minimum: 0
          maximum: 9000000000000000000
          description: "ENG: Reward amount - IT: Premio generato"
          example: 100
        trxDate:
          type: string
          format: date-time
          maxLength: 64
          description: "ENG: The date of the transaction - IT: La data della transazione"
        trxExpirationSeconds:
          type: number
          minimum: 0
          maximum: 31536000
          description: "ENG: Expiration time of the transaction, in seconds - IT: Scadenza della transazione, in secondi"
        updateDate:
          type: string
          format: date-time
          maxLength: 64
          description: "ENG: The date of the transaction update - IT: La data di aggiornamento della transazione"
        status:
          type: string
          enum:
            - CREATED
            - IDENTIFIED
            - AUTHORIZATION_REQUESTED
            - AUTHORIZED
            - REJECTED
          description: "ENG: Status of the transaction - IT: Stato della transazione"
        splitPayment:
          type: boolean
          description: "ENG: TRUE, if the authorized sum is less than the requested sum or FALSE, if the authorized sum is equal to the requested sum - IT: TRUE, se la somma autorizzata è inferiore alla somma richiesta o FALSE, se la somma autorizzata è uguale alla somma richiesta."
        residualAmountCents:
          type: integer
          format: int64
          minimum: 0
          maximum: 9000000000000000000
          description: "ENG: Remaining amount to be paid if the authorized sum is less than the requested sum - IT: Importo restante da pagare nel caso in cui la somma autorizzata sia inferiore alla somma richiesta."
        channel:
          type: string
          maxLength: 64
          description: "ENG: Channel from which the transaction takes place - IT: Canale da cui avviene la transazione"
        qrcodePngUrl:
          type: string
          maxLength: 2048
          format: uri
          description: "ENG: Url to the QR code image - IT: Url all'immagine del QR code"
        qrcodeTxtUrl:
          type: string
          maxLength: 2048
          format: uri
          description: "ENG: Url of the QR code link - IT: Url del QR code"
    MerchantTransactionsProcessedListDTO:
      type: object
      required:
        - content
        - pageNo
        - pageSize
        - totalElements
        - totalPages
      properties:
        content:
          type: array
          maxItems: 1000
          items:
            $ref: '#/components/schemas/MerchantTransactionProcessedDTO'
        pageNo:
          type: integer
          format: int32
          minimum: 0
          maximum: 100000
          description: "ENG: The number of the page - IT: Il numero della pagina"
        pageSize:
          type: integer
          format: int32
          minimum: 1
          maximum: 1000
          description: "ENG: The element size for page - IT: Il numero di elementi per pagina"
        totalElements:
          type: integer
          format: int32
          minimum: 0
          maximum: 1000000000
          description: "ENG: The total number of the elements - IT: Il numero totale degli elementi"
        totalPages:
          type: integer
          format: int32
          minimum: 0
          maximum: 100000
          description: "ENG: The total number of the pages - IT: Il numero totale delle pagine"
    MerchantTransactionProcessedDTO:
      type: object
      required:
        - trxId
        - effectiveAmountCents
        - status
      properties:
        trxId:
          type: string
          maxLength: 64
          description: "ENG: Transaction ID - IT: L'ID della transazione"
        fiscalCode:
          type: string
          maxLength: 16
          pattern: '^[A-Z0-9]{11,16}$'
          description: "ENG: Citizen fiscal code - IT: Codice fiscale del cittadino"
        effectiveAmountCents:
          type: integer
          format: int64
          minimum: 0
          maximum: 9000000000000000000
          description: "ENG: Transaction amount - IT: Quantitativo della transazione"
          example: 100
        rewardAmountCents:
          type: integer
          format: int64
          minimum: 0
          maximum: 9000000000000000000
          description: "ENG: Reward amount - IT: Premio generato"
          example: 100
        trxDate:
          type: string
          format: date-time
          maxLength: 64
          description: "ENG: The date of the transaction - IT: La data della transazione"
        updateDate:
          type: string
          format: date-time
          maxLength: 64
          description: "ENG: The date of the transaction update - IT: La data di aggiornamento della transazione"
        status:
          type: string
          enum:
            - REWARDED
            - CANCELLED
          description: "ENG: Status of the transaction - IT: Stato della transazione"
        channel:
          type: string
          maxLength: 64
          description: "ENG: Channel from which the transaction takes place - IT: Canale da cui avviene la transazione"
    ErrorDTO:
      type: object
      properties:
        code:
          type: string
          maxLength: 64
        message:
          type: string
          maxLength: 1024
    MerchantStatisticsDTO:
      type: object
      properties:
        amountCents:
          type: integer
          format: int64
          minimum: 0
          maximum: 9000000000000000000
          example: 100
        accruedCents:
          type: integer
          format: int64
          minimum: 0
          maximum: 9000000000000000000
          example: 100
        refundedCents:
          type: integer
          format: int64
          minimum: 0
          maximum: 9000000000000000000
          example: 100
    MerchantDetailDTO:
      type: object
      properties:
        initiativeId:
          type: string
          maxLength: 64
          pattern: '^[A-Z0-9\-_]+$'
          description: "ENG: The ID of the initiative <br> IT: L'ID' dell'iniziativa"
        initiativeName:
          type: string
          maxLength: 256
          description: "ENG: The name of the initiative <br> IT: Il nome dell'iniziativa"
        businessName:
          type: string
          maxLength: 256
          description: "ENG: The name of the merchant <br> IT: La ragione sociale dell'esercente"
        legalOfficeAddress:
          type: string
          maxLength: 256
          description: "ENG: The address of the legal office <br> IT: L'indirizzo della sede legale"
        legalOfficeMunicipality:
          type: string
          maxLength: 128
          description: "ENG: The municipality of the legal office <br> IT: Il comune della sede legale"
        legalOfficeProvince:
          type: string
          maxLength: 8
          description: "ENG: The province of the legal office <br> IT: La provincia della sede legale"
        legalOfficeZipCode:
          type: string
          maxLength: 16
          description: "ENG: The zipcode of the legal office <br> IT: Il CAP della sede legale"
        certifiedEmail:
          type: string
          maxLength: 320
          format: email
          description: "ENG: The certified email address of the merchant <br> IT: L'indirizzo email PEC dell' esercente"
        fiscalCode:
          type: string
          maxLength: 16
          pattern: '^[A-Z0-9]{11,16}$'
          description: "ENG: The fiscal code/vat number of the merchant <br> IT: Il codice fiscale/partita iva dell'esercente"
        vatNumber:
          type: string
          maxLength: 20
          description: "ENG: The vat number of the merchant <br> IT: La partita iva dell'esercente"
        status:
          type: string
          enum: [ UPLOADED ]
          description: "ENG: One of the possible merchant onboarding status: <ul><li>UPLOADED:This is the initial status after the csv upload</li></ul>IT: Uno dei possibili stati dell'onboarding da parte dell'esercente: <ul><li>UPLOADED:Questo è lo stato iniziale dopo il caricamento del file csv</li></ul>"
        iban:
          type: string
          maxLength: 34
          description: "ENG: The iban of the merchant <br> IT: L'iban dell'esercente"
        creationDate:
          type: string
          format: date-time
          maxLength: 64
          description: "ENG: Time and date of the initiative creation <br> IT: La data ed ora della creazione dell'iniziativa"
        updateDate:
          type: string
          format: date-time
          maxLength: 64
          description: "ENG: Time and date of the last status update <br> IT: La data ed ora dell'ultimo aggiornamento dello stato"
    MerchantErrorDTO:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: string
          enum:
            - MERCHANT_NOT_FOUND
            - MERCHANT_NOT_ONBOARDED
            - MERCHANT_TOO_MANY_REQUESTS
            - MERCHANT_INVALID_REQUEST
            - MERCHANT_GENERIC_ERROR
        message:
          type: string
          maxLength: 1024
    StatisticsErrorDTO:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: string
          enum:
            - STATISTICS_NOT_FOUND
            - STATISTICS_INVALID_REQUEST
            - STATISTICS_TOO_MANY_REQUESTS
            - STATISTICS_GENERIC_ERROR
        message:
          type: string
          maxLength: 1024
    TransactionErrorDTO:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: string
          enum:
            - PAYMENT_NOT_FOUND_OR_EXPIRED
            - PAYMENT_TRANSACTION_EXPIRED
            - PAYMENT_INITIATIVE_NOT_FOUND
            - PAYMENT_INITIATIVE_INVALID_DATE
            - PAYMENT_INITIATIVE_NOT_DISCOUNT
            - PAYMENT_ALREADY_AUTHORIZED
            - PAYMENT_ALREADY_CANCELLED
            - PAYMENT_BUDGET_EXHAUSTED
            - PAYMENT_GENERIC_REJECTED
            - PAYMENT_TOO_MANY_REQUESTS
            - PAYMENT_GENERIC_ERROR
            - PAYMENT_USER_SUSPENDED
            - PAYMENT_USER_NOT_ONBOARDED
            - PAYMENT_USER_UNSUBSCRIBED
            - PAYMENT_ALREADY_ASSIGNED
            - PAYMENT_NOT_ALLOWED_FOR_TRX_STATUS
            - PAYMENT_NOT_ALLOWED_MISMATCHED_MERCHANT
            - PAYMENT_USER_NOT_ASSOCIATED
            - PAYMENT_DELETE_NOT_ALLOWED_FOR_TRX_STATUS
            - PAYMENT_UNRELATE_NOT_ALLOWED_FOR_TRX_STATUS
            - PAYMENT_AMOUNT_NOT_VALID
            - PAYMENT_MERCHANT_NOT_ONBOARDED
            - PAYMENT_INVALID_REQUEST
            - PAYMENT_STATUS_NOT_VALID
        message:
          type: string
          maxLength: 1024
    ReportedUserRequestDTO:
      type: object
      required: [ merchantId, initiativeId, userFiscalCode ]
      properties:
        merchantId:
          type: string
          maxLength: 64
          pattern: '^[A-Z0-9\-_]+$'
          description: Merchant ID
          example: MERCHANT_12345
        initiativeId:
          type: string
          maxLength: 64
          pattern: '^[A-Z0-9\-_]+$'
          description: Initiative ID
          example: INITIATIVE_67890
        userFiscalCode:
          type: string
          maxLength: 16
          pattern: '^[A-Z0-9]{11,16}$'
          description: Citizen fiscal code
          example: RSSMRA85T10A562S
    ReportedUserCreateResponseDTO:
      type: object
      required: [ status, errorKey ]
      properties:
        status:
          type: string
          description: Outcome of the operation
          enum: [ OK, KO ]
          example: OK
        errorKey:
          type: string
          nullable: true
          description: >
            Error reason if status == KO; empty string otherwise.
            Possible business messages:
             - "UserId not found"
             - "Entity not found"
             - "Service unavailable"
             - "Different Merchant Id"
             - "Already reported"
             - "Different Initiative Id"
          enum:
            - ""
            - "UserId not found"
            - "Entity not found"
            - "Service unavailable"
            - "Different Merchant Id"
            - "Already reported"
            - "Different Initiative Id"
          maxLength: 64
          example: ""
    ReportedUserDTO:
      type: object
      required: [ fiscalCode, reportedDate ]
      properties:
        fiscalCode:
          type: string
          maxLength: 16
          pattern: '^[A-Z0-9]{11,16}$'
          description: Citizen fiscal code
          example: RSSMRA85T10A562S
        reportedDate:
          type: string
          format: date-time
          maxLength: 64
          description: When the user was reported
          example: 2025-10-30T09:15:12Z
        transactionId:
          type: string
          nullable: true
          maxLength: 64
          description: Related transaction ID (if any)
          example: TRX_001
        transactionDate:
          type: string
          format: date-time
          nullable: true
          maxLength: 64
          description: Related transaction date (if any)
          example: 2025-10-30T09:14:50Z
security:
  - Bearer: []
